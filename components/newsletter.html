<!-- components/newsletter.html -->
<section class="py-20 lg:py-28 bg-gradient-to-br from-pink-100 via-purple-50 to-yellow-50">
  <div class="container mx-auto px-6 max-w-5xl">
    <div class="text-center">
      <!-- TÃ­tulo con personalidad -->
      <h2 class="text-4xl md:text-5xl lg:text-6xl font-black text-pink-600 mb-6 leading-tight">
        ÃšNETE A NUESTRA<br>
        <span class="text-yellow-500 drop-shadow-lg">DULCE</span> CONSPIRACIÃ“N
      </h2>

      <!-- Texto provocador -->
      <p class="text-xl lg:text-2xl text-gray-800 mb-10 max-w-3xl mx-auto leading-relaxed">
        RecibirÃ¡s <strong>novedades prohibidas</strong>, ofertas secretas y tentaciones exclusivas.<br>
        <em>Una vez que entrasâ€¦ ya no hay vuelta atrÃ¡s.</em>
      </p>

      <!-- Formulario -->
      <form id="newsletterForm" class="max-w-2xl mx-auto flex flex-col sm:flex-row gap-4 shadow-2xl rounded-3xl overflow-hidden bg-white p-5">
        <input
          type="email"
          id="newsletterEmail"
          name="email"
          placeholder="Tu email... (prometo no contarlo)"
          required
          aria-label="DirecciÃ³n de email para suscribirse"
          class="flex-1 px-6 py-4 text-lg text-gray-800 rounded-2xl focus:outline-none focus:ring-4 focus:ring-pink-400 transition-shadow shadow-inner"
        />

        <!-- Checkbox de consentimiento (muy recomendado para GDPR) -->
        <div class="flex items-center justify-center sm:justify-start text-sm text-gray-700 mt-3 sm:mt-0">
          <input type="checkbox" id="consent" name="consent" required class="mr-2 w-5 h-5 accent-pink-600">
          <label for="consent">Acepto recibir emails con ofertas y pecados dulces</label>
        </div>

        <button
          type="submit"
          class="bg-pink-600 text-white font-black text-lg px-10 py-4 rounded-2xl hover:bg-pink-700 transition transform hover:scale-105 shadow-xl mt-4 sm:mt-0"
        >
          Quiero pecar â†’
        </button>
      </form>

      <!-- Mensaje de error -->
      <div id="errorMsg" class="hidden text-red-600 mt-6 text-lg">
        Algo saliÃ³ mal... Â¿puedes intentarlo de nuevo?
      </div>

      <!-- Mensaje de Ã©xito -->
      <div id="success" class="hidden text-center py-16 animate-fade-in">
        <div class="text-8xl mb-8">ğŸ‰ğŸ°ğŸ˜ˆ</div>
        <h3 class="text-4xl lg:text-5xl font-black text-pink-600 mb-6">
          Â¡Ya estÃ¡s dentro de la conspiraciÃ³n!
        </h3>
        <p class="text-xl lg:text-2xl text-gray-800 max-w-3xl mx-auto leading-relaxed">
          Te hemos enviado tu bienvenida + cÃ³digo de descuento al correo.<br>
          Revisa tu bandeja (y la carpeta de spam) en unos minutos.<br>
          Â¡PrepÃ¡rate para tentaciones malditamente deliciosas!
        </p>
      </div>
    </div>
  </div>
</section>  

  <!-- Estilos de animaciÃ³n -->
  <style>
    @keyframes fade-in {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .animate-fade-in {
      animation: fade-in 1s ease-out;
    }
  </style>

  <!-- EmailJS + LÃ³gica del formulario -->
 <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
<script>
  (function() {
    // InicializaciÃ³n correcta con publicKey (Â¡reemplaza con TU clave real!)
    emailjs.init({
      publicKey: "RU3xIhpZvPCm25Otj"  // â† Pon aquÃ­ tu Public Key exacta (la de Account > API Keys)
    });
  })();

  document.getElementById('newsletterForm').addEventListener('submit', function(e) {
    e.preventDefault();

    const form = this;
    const email = document.getElementById('newsletterEmail').value;
    const consent = document.getElementById('consent').checked;
    const success = document.getElementById('success');
    const errorMsg = document.getElementById('errorMsg');
    const submitButton = form.querySelector('button[type="submit"]');

    if (!consent) {
      alert("Debes aceptar recibir emails para continuar.");
      return;
    }

    submitButton.disabled = true;
    submitButton.textContent = "Enviando pecado...";

    const templateParams = {
      email: email,
      nombre: "pecador/a dulce",
      discount_code: "PECADO10",
      // AÃ±ade mÃ¡s si tu plantilla las usa, ej: to_name: "TÃº", reply_to: email
    };

    // â† Â¡REEMPLAZA ESTOS DOS VALORES CON LOS REALES DE TU DASHBOARD!
    emailjs.send(
      'service_TU_SERVICE_ID_AQUI',       // Ej: 'service_abc123xyz' (de Email Services)
      'template_TU_TEMPLATE_ID_AQUI',     // Ej: 'bienvenida_maldita' (de Email Templates)
      templateParams
    )
    .then((response) => {
      console.log('EMAIL ENVIADO CON Ã‰XITO!', response.status, response.text);
      form.classList.add('opacity-0', 'translate-y-4', 'transition-all', 'duration-500');
      setTimeout(() => {
        form.classList.add('hidden');
        success.classList.remove('hidden');
        success.classList.add('animate-fade-in');
      }, 500);
      form.reset();
    })
    .catch((err) => {
      console.error('ERROR AL ENVIAR EMAIL:', err);
      console.log('Status:', err.status);        // Ej: 400
      console.log('Texto error:', err.text);     // Ej: "The service ID is invalid..."
      errorMsg.classList.remove('hidden');
      errorMsg.innerHTML = `Error: ${err.text || 'IntÃ©ntalo de nuevo mÃ¡s tarde'}`;
    })
    .finally(() => {
      submitButton.disabled = false;
      submitButton.textContent = "Quiero pecar â†’";
    });
  });
</script>
