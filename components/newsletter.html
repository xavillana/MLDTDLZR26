<!-- components/newsletter.html -->
<section class="py-20 lg:py-28 bg-gradient-to-br from-pink-100 via-purple-50 to-yellow-50">
  <div class="container mx-auto px-6 max-w-5xl">
    <div class="text-center">
      <!-- TÃ­tulo con mÃ¡s personalidad -->
      <h2 class="text-4xl md:text-5xl lg:text-6xl font-black text-pink-600 mb-6 leading-tight">
        ÃšNETE A NUESTRA<br>
        <span class="text-yellow-500 drop-shadow-lg">DULCE</span> CONSPIRACIÃ“N
      </h2>

      <!-- Texto provocador -->
      <p class="text-xl lg:text-2xl text-gray-800 mb-12 max-w-3xl mx-auto leading-relaxed">
        RecibirÃ¡s <strong>novedades prohibidas</strong>, ofertas secretas y tentaciones exclusivas que harÃ¡n temblar hasta a los mÃ¡s fuertes. <br>
        <em>Una vez que entrasâ€¦ ya no hay vuelta atrÃ¡s.</em>
      </p>

      <!-- Formulario mejorado -->
      <form id="newsletterForm" class="max-w-2xl mx-auto flex flex-col sm:flex-row gap-6 shadow-2xl rounded-3xl overflow-hidden bg-white p-4">
        <input
          type="email"
          id="newsletterEmail"
          name="email"
          placeholder="Tu email... (prometo no contarlo)"
          required
          aria-label="DirecciÃ³n de email para suscribirse"
          class="flex-1 px-8 py-5 text-lg text-gray-800 rounded-2xl focus:outline-none focus:ring-4 focus:ring-pink-400 transition-shadow shadow-inner"
        />
        <button
          type="submit"
          id="submitButton"
          class="bg-gradient-to-r from-pink-600 to-purple-600 text-white font-black text-xl px-10 py-5 rounded-2xl hover:from-pink-700 hover:to-purple-700 transition-all duration-300 transform hover:scale-105 shadow-2xl whitespace-nowrap"
        >
          Quiero pecar â†’
        </button>
      </form>

      <!-- Mensaje de Ã©xito (oculto por defecto) -->
      <div id="newsletterSuccess" class="hidden mt-10">
        <div class="text-7xl mb-6 animate-bounce">ğŸ˜ˆğŸ°</div>
        <h3 class="text-3xl lg:text-4xl font-black text-pink-600 mb-4">
          Â¡Bienvenid@ a la conspiraciÃ³n!
        </h3>
        <p class="text-xl text-gray-700 max-w-2xl mx-auto">
          Revisa tu bandeja de entrada: te hemos enviado un email para confirmar.<br>
          <strong>Haz clic en el botÃ³n</strong> para activar tu suscripciÃ³n y recibir tu descuento del 10%.
        </p>
      </div>

      <!-- Mensaje de error (opcional) -->
      <div id="newsletterError" class="hidden mt-10 text-red-600 text-xl font-bold">
        Â¡Ups! Algo ha fallado. IntÃ©ntalo de nuevo o escribe a hola@malditadulzura.com
      </div>
    </div>
  </div>
</section>

<!-- Cargar EmailJS SDK -->
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
<script type="text/javascript">
  (function() {
    // Reemplaza con tu Public Key de EmailJS
    emailjs.init("_2bMo7kx-EP4ljBKr");
  })();
</script>

<script type="module">
  const form = document.getElementById('newsletterForm');
  const success = document.getElementById('newsletterSuccess');
  const errorMsg = document.getElementById('newsletterError');
  const submitButton = document.getElementById('submitButton');

  form.addEventListener('submit', function(e) {
    e.preventDefault();

    // Desactivar botÃ³n y mostrar loading
    submitButton.disabled = true;
    submitButton.textContent = "Enviando tentaciÃ³n...";

    const email = document.getElementById('newsletterEmail').value.trim();

    // Generar un token Ãºnico simple (en producciÃ³n deberÃ­as hacerlo en el backend)
    const token = btoa(email + Date.now()).replace(/=/g, '').substring(0, 20);
    const confirmationLink = `https://malditadulzura.com/confirmar?token=\( {token}&email= \){encodeURIComponent(email)}`;

    const templateParams = {
      nombre: "pecador/a dulce", // Puedes aÃ±adir un campo nombre si quieres
      email: email,
      confirmation_link: confirmationLink
    };

    // Reemplaza con tu Service ID y Template ID reales
    emailjs.send('service_a1r8kaa', 'template_bienvenida', templateParams)
      .then(() => {
        // Ocultar formulario y mostrar Ã©xito
        form.classList.add('opacity-0', 'translate-y-4', 'transition-all', 'duration-500');
        
        setTimeout(() => {
          form.classList.add('hidden');
          success.classList.remove('hidden');
          success.classList.add('animate-fade-in');
        }, 500);

        form.reset();
      })
      .catch((err) => {
        console.error('Error EmailJS:', err);
        errorMsg.classList.remove('hidden');
      })
      .finally(() => {
        submitButton.disabled = false;
        submitButton.textContent = "Quiero pecar â†’";
      });
  });
</script>

<style>
  @keyframes fade-in {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
  }
  .animate-fade-in {
    animation: fade-in 1s ease-out;
  }
  </style>

