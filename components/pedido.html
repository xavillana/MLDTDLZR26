<!-- components/pedido.html -->
<section class="py-16 lg:py-28 bg-gray-50">
  <div class="container mx-auto px-4 max-w-5xl">
    <div class="text-center mb-12">
      <h2 class="text-4xl md:text-5xl lg:text-6xl font-black text-pink-600 mb-6">
        Realiza tu Pedido
      </h2>
      <p class="text-xl text-gray-700 max-w-3xl mx-auto">
        Cu√©ntanos qu√© delicia rebelde deseas y te daremos un presupuesto personalizado en menos de 24h.
      </p>
    </div>

    <!-- Formulario -->
    <form id="orderForm" class="bg-white rounded-3xl shadow-2xl p-8 lg:p-12 space-y-10">
      <!-- Informaci√≥n Personal -->
      <div class="grid lg:grid-cols-2 gap-8">
        <div>
          <label for="nombre" class="block text-lg font-semibold text-gray-800 mb-2">Nombre completo *</label>
          <input type="text" id="nombre" required class="w-full px-5 py-4 rounded-xl border border-gray-300 focus:border-pink-600 focus:ring-4 focus:ring-pink-200 transition">
        </div>
        <div>
          <label for="telefono" class="block text-lg font-semibold text-gray-800 mb-2">Tel√©fono *</label>
          <input type="tel" id="telefono" required class="w-full px-5 py-4 rounded-xl border border-gray-300 focus:border-pink-600 focus:ring-4 focus:ring-pink-200 transition">
        </div>
        <div class="lg:col-span-2">
          <label for="email" class="block text-lg font-semibold text-gray-800 mb-2">Email *</label>
          <input type="email" id="email" required class="w-full px-5 py-4 rounded-xl border border-gray-300 focus:border-pink-600 focus:ring-4 focus:ring-pink-200 transition">
        </div>
      </div>

      <!-- Producto y Detalles -->
      <div class="grid lg:grid-cols-2 gap-8">
        <div>
          <label for="producto" class="block text-lg font-semibold text-gray-800 mb-2">¬øQu√© delicia quieres? *</label>
          <select id="producto" required class="w-full px-5 py-4 rounded-xl border border-gray-300 focus:border-pink-600 focus:ring-4 focus:ring-pink-200 transition">
            <option value="">Selecciona un producto</option>
            <!-- Opciones inyectadas por JS -->
          </select>
        </div>
        <div>
          <label for="tama√±o" class="block text-lg font-semibold text-gray-800 mb-2">Tama√±o *</label>
          <select id="tama√±o" disabled required class="w-full px-5 py-4 rounded-xl border border-gray-300 focus:border-pink-600 focus:ring-4 focus:ring-pink-200 transition">
            <option value="">Primero elige un producto</option>
          </select>
        </div>
        <div class="lg:col-span-2 bg-pink-50 rounded-2xl p-6 text-center">
          <p class="text-lg text-gray-700 mb-2">Precio estimado</p>
          <p id="precioEstimado" class="text-4xl font-black text-pink-600">Selecciona producto y tama√±o</p>
        </div>
      </div>

      <!-- Entrega -->
      <div class="grid lg:grid-cols-3 gap-8">
        <div>
          <label for="fechaEntrega" class="block text-lg font-semibold text-gray-800 mb-2">Fecha de entrega/recogida *</label>
          <input type="date" id="fechaEntrega" required min="" class="w-full px-5 py-4 rounded-xl border border-gray-300 focus:border-pink-600 focus:ring-4 focus:ring-pink-200 transition">
        </div>
        <div>
          <label for="horaEntrega" class="block text-lg font-semibold text-gray-800 mb-2">Hora aproximada</label>
          <input type="time" id="horaEntrega" class="w-full px-5 py-4 rounded-xl border border-gray-300 focus:border-pink-600 focus:ring-4 focus:ring-pink-200 transition">
        </div>
        <div>
          <label class="block text-lg font-semibold text-gray-800 mb-2">Tipo de entrega *</label>
          <div class="flex flex-col sm:flex-row gap-4">
            <label class="flex items-center">
              <input type="radio" name="tipoEntrega" value="recogida" checked required class="mr-3 text-pink-600">
              <span>Recogida en tienda</span>
            </label>
            <label class="flex items-center">
              <input type="radio" name="tipoEntrega" value="envio" class="mr-3 text-pink-600">
              <span>Env√≠o a domicilio</span>
            </label>
          </div>
        </div>
      </div>

      <!-- Direcci√≥n (solo si env√≠o) -->
      <div id="direccionContainer" class="hidden">
        <label for="direccion" class="block text-lg font-semibold text-gray-800 mb-2">Direcci√≥n completa de env√≠o *</label>
        <textarea id="direccion" rows="3" class="w-full px-5 py-4 rounded-xl border border-gray-300 focus:border-pink-600 focus:ring-4 focus:ring-pink-200 transition"></textarea>
      </div>

      <!-- Personalizaci√≥n -->
      <div class="grid lg:grid-cols-2 gap-8">
        <div>
          <label for="tema" class="block text-lg font-semibold text-gray-800 mb-2">Tema o dedicatoria (opcional)</label>
          <input type="text" id="tema" placeholder="Ej: Cumplea√±os rockero, boda g√≥tica..." class="w-full px-5 py-4 rounded-xl border border-gray-300 focus:border-pink-600 focus:ring-4 focus:ring-pink-200 transition">
        </div>
        <div>
          <label for="texto" class="block text-lg font-semibold text-gray-800 mb-2">Texto para la tarta (opcional)</label>
          <input type="text" id="texto" placeholder="Ej: Feliz 30, diablillo" class="w-full px-5 py-4 rounded-xl border border-gray-300 focus:border-pink-600 focus:ring-4 focus:ring-pink-200 transition">
        </div>
      </div>

      <!-- Comentarios adicionales -->
      <div>
        <label for="comentarios" class="block text-lg font-semibold text-gray-800 mb-2">Comentarios o peticiones especiales</label>
        <textarea id="comentarios" rows="4" placeholder="Alergias, preferencias de color, ideas locas..." class="w-full px-5 py-4 rounded-xl border border-gray-300 focus:border-pink-600 focus:ring-4 focus:ring-pink-200 transition"></textarea>
      </div>

      <!-- Bot√≥n enviar -->
      <div class="text-center">
        <button type="submit" class="bg-gradient-to-r from-pink-600 to-purple-600 text-white px-12 py-6 rounded-2xl font-black text-2xl hover:from-pink-700 hover:to-purple-700 transition transform hover:scale-105 shadow-2xl">
          Enviar Pedido ‚Üí
        </button>
      </div>
    </form>

    <!-- Mensaje de √©xito -->
    <div id="successMessage" class="hidden bg-gradient-to-r from-pink-100 to-purple-100 rounded-3xl shadow-2xl p-12 text-center mt-12">
      <div class="text-6xl mb-6">üç∞‚ú®</div>
      <h3 class="text-3xl lg:text-4xl font-black text-gray-800 mb-4">
        ¬°Pedido enviado con √©xito!
      </h3>
      <p class="text-xl text-gray-700 max-w-2xl mx-auto">
        Hemos recibido tu solicitud. Te contactaremos en menos de 24 horas con el presupuesto definitivo y confirmaci√≥n.
      </p>
      <p class="text-lg text-gray-600 mt-6">
        ¬°Gracias por confiar en Maldita Dulzura para tu pr√≥xima tentaci√≥n!
      </p>
    </div>
  </div>
</section>

<script type="module">
  import { allProducts } from '../js/data/allProducts.js';

  const form = document.getElementById('orderForm');
  const successMessage = document.getElementById('successMessage');
  const productoSelect = document.getElementById('producto');
  const tama√±oSelect = document.getElementById('tama√±o');
  const precioEstimado = document.getElementById('precioEstimado');
  const direccionContainer = document.getElementById('direccionContainer');
  const direccionInput = document.getElementById('direccion');
  const fechaInput = document.getElementById('fechaEntrega');

  // Fecha m√≠nima: hoy + 3 d√≠as (para dar tiempo de preparaci√≥n)
  const today = new Date();
  today.setDate(today.getDate() + 3);
  fechaInput.min = today.toISOString().split('T')[0];

  // Llenar select de productos
  allProducts.forEach(product => {
    const option = document.createElement('option');
    option.value = product.id;
    option.textContent = `${product.emoji} ${product.name}`;
    productoSelect.appendChild(option);
  });

  // Mostrar/ocultar direcci√≥n
  document.querySelectorAll('input[name="tipoEntrega"]').forEach(radio => {
    radio.addEventListener('change', () => {
      if (radio.value === 'envio') {
        direccionContainer.classList.remove('hidden');
        direccionInput.required = true;
      } else {
        direccionContainer.classList.add('hidden');
        direccionInput.required = false;
      }
    });
  });

  // Calcular precio estimado
  function calculatePrice() {
    const productId = productoSelect.value;
    const size = tama√±oSelect.value;

    if (!productId || !size) {
      precioEstimado.textContent = 'Selecciona producto y tama√±o';
      return;
    }

    const product = allProducts.find(p => p.id === productId);
    if (!product) return;

    let price = 0;
    if (product.sizes) {
      const sizeObj = product.sizes.find(s => (s.size || s.name).toLowerCase() === size.toLowerCase());
      price = sizeObj ? sizeObj.price : 0;
    } else {
      price = product.price || product.cupcakePrice || 0;
    }

    precioEstimado.textContent = `${price}‚Ç¨`;
  }

  // Habilitar tama√±os al elegir producto
  productoSelect.addEventListener('change', () => {
    const productId = productoSelect.value;
    tama√±oSelect.innerHTML = '<option value="">Selecciona tama√±o</option>';
    tama√±oSelect.disabled = !productId;

    if (productId) {
      const product = allProducts.find(p => p.id === productId);
      if (product && product.sizes) {
        product.sizes.forEach(s => {
          const opt = document.createElement('option');
          opt.value = s.size || s.name;
          opt.textContent = `${s.size || s.name} (${s.servings} personas) - ${s.price}‚Ç¨`;
          tama√±oSelect.appendChild(opt);
        });
      } else {
        // Si no tiene tama√±os (ej: cupcake individual)
        const opt = document.createElement('option');
        opt.value = '√∫nico';
        opt.textContent = `√önico - ${product.price || product.cupcakePrice}‚Ç¨`;
        tama√±oSelect.appendChild(opt);
        tama√±oSelect.value = '√∫nico';
      }
    }
    calculatePrice();
  });

  tama√±oSelect.addEventListener('change', calculatePrice);

  // Enviar formulario (simulaci√≥n)
  form.addEventListener('submit', (e) => {
    e.preventDefault();
    
    // Aqu√≠ podr√≠as conectar con EmailJS, Formspree, etc.
    // Por ahora, simulamos env√≠o exitoso
    form.classList.add('hidden');
    successMessage.classList.remove('hidden');
    window.scrollTo({ top: successMessage.offsetTop - 100, behavior: 'smooth' });
  });
</script>
